<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="/web/favicon.ico">
  <link rel="apple-touch-icon" href="/web/apple-touch-icon.png">
  <link rel="manifest" href="/web/manifest.json">
  <meta name="theme-color" content="#3b82f6">
  <title>请求日志 - Claude Code & Codex Proxy</title>
  <link rel="stylesheet" href="/web/assets/css/styles.css?v=__VERSION__">
  <link href="/web/assets/css/inter.css?v=__VERSION__" rel="stylesheet">
  <link rel="stylesheet" href="/web/assets/css/channels.css?v=__VERSION__">
  <link rel="stylesheet" href="/web/assets/css/logs.css?v=__VERSION__">
</head>
<body>
  <div class="app-container">
    

    <!-- 主内容区域 -->
    <main class="main-content">
      <div class="content-area">
     <!-- 页面标题 -->
        <header class="mb-2">
        </header>

        <!-- Filter Bar -->
        <div class="filter-bar">
          <div class="filter-controls">
            <!-- 渠道类型筛选 -->
            <div class="filter-group">
              <label for="f_channel_type" class="filter-label">渠道类型</label>
              <select id="f_channel_type" class="filter-select" style="min-width: 120px;">
                <!-- 动态加载渠道类型选项 -->
              </select>
            </div>

            <!-- 时间范围筛选 -->
            <div class="filter-group">
              <label for="f_hours" class="filter-label">时间范围</label>
              <select id="f_hours" class="filter-select" style="min-width: 100px;">
                <!-- 动态生成选项 by date-range-selector.js -->
              </select>
            </div>

            <!-- 渠道ID筛选 -->
            <div class="filter-group">
              <label for="f_id" class="filter-label">渠道ID</label>
              <input type="number" id="f_id" class="filter-input" placeholder="输入ID..." style="max-width: 100px;">
            </div>

            <!-- 渠道名筛选 -->
            <div class="filter-group">
              <label for="f_name" class="filter-label">渠道名</label>
              <input type="text" id="f_name" class="filter-input" placeholder="包含文本...">
            </div>

            <!-- 模型筛选（合并重复字段） -->
            <div class="filter-group">
              <label for="f_model" class="filter-label">模型</label>
              <input type="text" id="f_model" class="filter-input" placeholder="包含文本...">
            </div>

            <!-- 状态码筛选 -->
            <div class="filter-group">
              <label for="f_status" class="filter-label">状态码</label>
              <input type="number" id="f_status" class="filter-input" placeholder="如 200 / 403" style="max-width: 110px;">
            </div>

            <!-- 令牌筛选 -->
            <div class="filter-group">
              <label for="f_auth_token" class="filter-label">令牌</label>
              <select id="f_auth_token" class="filter-select" style="min-width: 150px;">
                <option value="">全部令牌</option>
                <!-- 动态加载令牌列表 -->
              </select>
            </div>

            <!-- 统计信息 -->
            <div class="filter-info">
              显示 <span id="displayedCount">0</span> / <span id="totalCount">0</span> 条
            </div>

            <!-- 操作按钮组 -->
            <div style="flex: none;">
              <button id="btn_filter" type="button" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">筛选</button>
            </div>
          </div>
        </div>

  
        <!-- 日志列表 -->
        <section class="mb-2">
          <div class="glass-card animate-slide-up" style="animation-delay: 0.2s;">
           
            
            <!-- 日志表格 -->
            <div class="table-container">
              <table class="modern-table logs-table">
                <thead>
                  <tr>
                    <th>时间</th>
                    <th>IP</th>
                    <th>模型</th>
                    <th>渠道</th>
                    <th>API Key</th>
                    <th>状态码</th>
                    <th>首字/耗时(秒)</th>
                    <th>输入</th>
                    <th>输出</th>
                    <th>缓存读</th>
                    <th>缓存建</th>
                    <th>成本</th>
                    <th>信息</th>
                  </tr>
                </thead>
                <tbody id="tbody">
                  <tr>
                    <td colspan="13" class="loading-state">
                      <div class="loading-spinner" style="margin: 0 auto var(--space-2)"></div>
                      正在加载日志...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 底部分页控制 -->
        <section class="mb-2">
          <div class="glass-card" style="padding: var(--space-2);">
            <div class="flex justify-center items-center">
              <div class="pagination-controls">
                <button id="logs_prev2" class="btn btn-secondary btn-sm" onclick="prevLogsPage()">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                  上一页
                </button>
                <span class="pagination-info" style="margin: 0 var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
                  第 <span id="logs_current_page2">1</span> 页，共 <span id="logs_total_pages2">1</span> 页
                  <span style="margin-left: var(--space-2);">|</span>
                  跳转到
                  <input
                    type="number"
                    id="logs_jump_page"
                    min="1"
                    max="1"
                    placeholder="页码"
                    style="width: 100px; padding: 4px 8px; border: 1px solid var(--neutral-300); border-radius: 4px; text-align: center;"
                    onkeydown="if(event.key==='Enter') jumpToPage()"
                  />
                  页
                </span>
                <button id="logs_next2" class="btn btn-secondary btn-sm" onclick="nextLogsPage()">
                  下一页
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- 测试 API Key 模态框 -->
  <div id="testKeyModal" class="modal">
    <div class="modal-content test-modal-content">
      <div class="modal-header">
        <h2 class="modal-title">测试 API Key - <span id="testKeyChannelName"></span></h2>
        <button class="close-btn" onclick="closeTestKeyModal()">&times;</button>
      </div>

      <div class="form-group">
        <label class="form-label">API Key</label>
        <code id="testKeyDisplay" style="display: block; padding: 8px; background: var(--neutral-100); border-radius: 4px; color: var(--neutral-700);"></code>
        <small id="testKeyIndexInfo" style="color: var(--neutral-600); font-size: 0.85em; display: block; margin-top: 6px;"></small>
      </div>

      <div class="form-group">
        <label class="form-label" for="testKeyModel">测试模型</label>
        <select id="testKeyModel" class="form-input">
          <option value="">加载中...</option>
        </select>
        <small style="color: var(--neutral-600); font-size: 0.85em; margin-top: 4px; display: block;">
          日志中的模型: <code id="testKeyOriginalModel" style="color: var(--neutral-700);"></code>
        </small>
      </div>

      <div class="form-group">
        <label class="form-label" for="testKeyContent">测试内容</label>
        <input type="text" id="testKeyContent" class="form-input" placeholder="输入测试消息内容">
      </div>

      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="testKeyStream" checked>
          <span class="form-label" style="margin: 0;">启用流式响应</span>
        </label>
      </div>

      <!-- 测试进度 -->
      <div id="testKeyProgress" class="test-progress">
        <div class="loading-spinner"></div>
        <p>正在测试 API Key...</p>
      </div>

      <!-- 测试结果 -->
      <div id="testKeyResult" class="test-result">
        <div id="testKeyResultContent"></div>
        <div id="testKeyResultDetails" class="test-details"></div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="closeTestKeyModal()">关闭</button>
        <button type="button" id="runKeyTestBtn" class="btn btn-primary" onclick="runKeyTest()">开始测试</button>
      </div>
    </div>
  </div>


  <!-- 日志表格行模板 -->
  <template id="tpl-log-row">
    <tr>
      <td style="white-space: nowrap;">{{time}}</td>
      <td style="white-space: nowrap; font-family: monospace; font-size: 0.85em; color: var(--neutral-600);">{{{clientIPDisplay}}}</td>
      <td>{{{modelDisplay}}}</td>
      <td class="config-info">{{{configDisplay}}}</td>
      <td style="text-align: center; white-space: nowrap;">{{{apiKeyDisplay}}}</td>
      <td><span class="{{statusClass}}">{{statusCode}}</span></td>
      <td style="text-align: right; white-space: nowrap;">{{{responseTimingDisplay}}}</td>
      <td style="text-align: right; white-space: nowrap;">{{{inputTokensDisplay}}}</td>
      <td style="text-align: right; white-space: nowrap;">{{{outputTokensDisplay}}}</td>
      <td style="text-align: right; white-space: nowrap;">{{{cacheReadDisplay}}}</td>
      <td style="text-align: right; white-space: nowrap;">{{{cacheCreationDisplay}}}</td>
      <td style="text-align: right; white-space: nowrap;">{{{costDisplay}}}</td>
      <td style="max-width: 300px; word-break: break-word;">{{message}}</td>
    </tr>
  </template>

  <!-- 空状态模板 -->
  <template id="tpl-log-empty">
    <tr>
      <td colspan="{{colspan}}" class="empty-state">
        <svg class="w-12 h-12 mx-auto mb-4" style="color: var(--neutral-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <div style="font-weight: var(--font-medium); margin-bottom: var(--space-1); color: var(--neutral-700);">暂无日志数据</div>
        <div>请调整筛选条件或检查时间范围</div>
      </td>
    </tr>
  </template>

  <!-- 加载状态模板 -->
  <template id="tpl-log-loading">
    <tr>
      <td colspan="{{colspan}}" class="loading-state">
        <div class="loading-spinner" style="margin: 0 auto var(--space-2)"></div>
        正在加载日志...
      </td>
    </tr>
  </template>

  <!-- 错误状态模板 -->
  <template id="tpl-log-error">
    <tr>
      <td colspan="{{colspan}}" class="empty-state">
        <svg class="w-12 h-12 mx-auto mb-4" style="color: var(--error-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L4.18 16.5c-.77.833.192 2.5 1.732 2.5z"/>
        </svg>
        <div style="color: var(--error-400); font-weight: var(--font-medium); margin-bottom: var(--space-1);">加载失败</div>
        <div>请检查网络连接或重试</div>
      </td>
    </tr>
  </template>

  <script src="/web/assets/js/template-engine.js?v=__VERSION__"></script>
  <script src="/web/assets/js/date-range-selector.js?v=__VERSION__"></script>
  <script src="/web/assets/js/ui.js?v=__VERSION__"></script>
  <script src="/web/assets/js/logs.js?v=__VERSION__"></script>
</body>
</html>
