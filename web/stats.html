<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è°ƒç”¨ç»Ÿè®¡ - Claude Code & Codex Proxy</title>
  <link rel="stylesheet" href="/web/styles.css">
  <link rel="preconnect" href="https://fonts.loli.net">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.loli.net/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .stats-table th {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app-container">
    

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
      <div class="content-area">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <header class="mb-2">
        </header>

        <!-- ç­›é€‰åŒºåŸŸï¼šé‡‡ç”¨æ°´å¹³å¸ƒå±€ï¼Œå‚è€ƒchannels.htmlè®¾è®¡ -->
        <section class="mb-4">
          <div class="glass-card animate-slide-up" style="animation-delay: 0.1s;">
            <div class="filter-bar">
              <div class="filter-controls">
                <!-- æœ€è¿‘å°æ—¶ç­›é€‰ -->
                <div class="filter-group">
                  <label for="f_hours" class="filter-label">æœ€è¿‘å°æ—¶</label>
                  <select id="f_hours" class="filter-select" style="min-width: 100px;">
                    <option value="1">1å°æ—¶</option>
                    <option value="3">3å°æ—¶</option>
                    <option value="6">6å°æ—¶</option>
                    <option value="12">12å°æ—¶</option>
                    <option value="24" selected>24å°æ—¶</option>
                    <option value="48">48å°æ—¶</option>
                    <option value="72">72å°æ—¶</option>
                  </select>
                </div>

                <!-- æ¸ é“IDç­›é€‰ -->
                <div class="filter-group">
                  <label for="f_id" class="filter-label">æ¸ é“ID</label>
                  <input type="number" id="f_id" class="filter-input" placeholder="è¾“å…¥ID..." style="max-width: 100px;">
                </div>

                <!-- æ¸ é“åç­›é€‰ -->
                <div class="filter-group">
                  <label for="f_name" class="filter-label">æ¸ é“å</label>
                  <input type="text" id="f_name" class="filter-input" placeholder="åŒ…å«æ–‡æœ¬...">
                </div>

                <!-- æ¨¡å‹ç­›é€‰ï¼ˆåˆå¹¶é‡å¤å­—æ®µï¼‰ -->
                <div class="filter-group">
                  <label for="f_model" class="filter-label">æ¨¡å‹</label>
                  <input type="text" id="f_model" class="filter-input" placeholder="åŒ…å«æ–‡æœ¬...">
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="filter-info">
                  å…± <span id="statsCount">0</span> æ¡è®°å½•
                </div>

                <!-- æ“ä½œæŒ‰é’®ç»„ -->
                <div style="flex: none;">
                  <button id="btn_filter" type="button" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">ç­›é€‰</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ç»Ÿè®¡æ‘˜è¦å¡ç‰‡ -->
        <section class="mb-8">
          <div class="grid grid-cols-4 animate-slide-up" style="animation-delay: 0.2s;">
            <div class="metric-card">
              <div class="metric-number" id="total-channels" style="color: var(--primary-500);">--</div>
              <div class="metric-label">æ¸ é“æ•°é‡</div>
            </div>
            <div class="metric-card">
              <div class="metric-number" id="total-models" style="color: var(--info-500);">--</div>
              <div class="metric-label">æ¨¡å‹æ•°é‡</div>
            </div>
            <div class="metric-card">
              <div class="metric-number" id="total-success" style="color: var(--success-500);">--</div>
              <div class="metric-label">æˆåŠŸè°ƒç”¨</div>
            </div>
            <div class="metric-card">
              <div class="metric-number" id="total-error" style="color: var(--error-500);">--</div>
              <div class="metric-label">å¤±è´¥è°ƒç”¨</div>
            </div>
          </div>
        </section>

        <!-- ç»Ÿè®¡è¯¦æƒ…è¡¨æ ¼ -->
        <section class="mb-8">
          <div class="glass-card animate-slide-up" style="animation-delay: 0.3s;">
            <h3 class="section-title mb-6">
              <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              è¯¦ç»†ç»Ÿè®¡æ•°æ®
              <small style="color: var(--neutral-600); font-weight: var(--font-normal); margin-left: var(--space-2);">
                æŒ‰æ¸ é“åç§°ã€æ¨¡å‹åç§°æ’åº
              </small>
            </h3>
            
            <!-- ç»Ÿè®¡è¡¨æ ¼ -->
            <div class="table-container">
              <table class="modern-table stats-table">
                <thead>
                  <tr>
                    <th class="sortable" data-column="channel_name" onclick="sortTable('channel_name')">
                      æ¸ é“åç§°
                      <span class="sort-indicator" id="sort-channel_name"></span>
                    </th>
                    <th class="sortable" data-column="model" onclick="sortTable('model')">
                      æ¨¡å‹
                      <span class="sort-indicator" id="sort-model"></span>
                    </th>
                    <th class="sortable" data-column="success" onclick="sortTable('success')" style="color: var(--success-400);">
                      æˆåŠŸæ¬¡æ•°
                      <span class="sort-indicator" id="sort-success"></span>
                    </th>
                    <th class="sortable" data-column="error" onclick="sortTable('error')" style="color: var(--error-400);">
                      å¤±è´¥æ¬¡æ•°
                      <span class="sort-indicator" id="sort-error"></span>
                    </th>
                    <th class="sortable" data-column="total" onclick="sortTable('total')">
                      æ€»æ¬¡æ•°
                      <span class="sort-indicator" id="sort-total"></span>
                    </th>
                    <th class="sortable" data-column="success_rate" onclick="sortTable('success_rate')">
                      æˆåŠŸç‡
                      <span class="sort-indicator" id="sort-success_rate"></span>
                    </th>
                    <th class="sortable" data-column="avg_first_byte_time" onclick="sortTable('avg_first_byte_time')">
                      å¹³å‡é¦–å­—æ—¶é—´
                      <span class="sort-indicator" id="sort-avg_first_byte_time"></span>
                    </th>
                    <th class="sortable" data-column="total_input_tokens" onclick="sortTable('total_input_tokens')">
                      è¾“å…¥Token
                      <span class="sort-indicator" id="sort-total_input_tokens"></span>
                    </th>
                    <th class="sortable" data-column="total_output_tokens" onclick="sortTable('total_output_tokens')">
                      è¾“å‡ºToken
                      <span class="sort-indicator" id="sort-total_output_tokens"></span>
                    </th>
                    <th class="sortable" data-column="total_cache_read" onclick="sortTable('total_cache_read')" style="color: var(--success-600);">
                      ç¼“å­˜è¯»å–
                      <span class="sort-indicator" id="sort-total_cache_read"></span>
                    </th>
                    <th class="sortable" data-column="total_cache_creation" onclick="sortTable('total_cache_creation')" style="color: var(--primary-600);">
                      ç¼“å­˜åˆ›å»º
                      <span class="sort-indicator" id="sort-total_cache_creation"></span>
                    </th>
                    <th class="sortable" data-column="total_cost" onclick="sortTable('total_cost')" style="color: var(--warning-600);">
                      æˆæœ¬($)
                      <span class="sort-indicator" id="sort-total_cost"></span>
                    </th>
                  </tr>
                </thead>
                <tbody id="stats_tbody"></tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  


  <script>
    // å¸¸é‡å®šä¹‰
    const STATS_TABLE_COLUMNS = 12; // ç»Ÿè®¡è¡¨åˆ—æ•°ï¼ˆå¢åŠ äº†5åˆ—ï¼šè¾“å…¥Tokenã€è¾“å‡ºTokenã€ç¼“å­˜è¯»å–ã€ç¼“å­˜åˆ›å»ºã€æˆæœ¬ï¼‰
    
    let statsData = null;
    let sortState = {
      column: null,
      order: null // null, 'asc', 'desc'
    };

    async function loadStats() {
      try {
        showLoading();
        
        const u = new URLSearchParams(location.search);
        const params = new URLSearchParams({
          hours: (u.get('hours')||'24')
        });
        
        // å¤ç”¨ç­›é€‰æ¡ä»¶
        if (u.get('channel_id')) params.set('channel_id', u.get('channel_id'));
        if (u.get('channel_name')) params.set('channel_name', u.get('channel_name'));
        if (u.get('channel_name_like')) params.set('channel_name_like', u.get('channel_name_like'));
        if (u.get('model')) params.set('model', u.get('model'));
        if (u.get('model_like')) params.set('model_like', u.get('model_like'));

        const res = await fetchWithAuth('/admin/stats?' + params.toString());
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const response = await res.json();
        // åç«¯è¿”å›æ ¼å¼: {"success":true,"data":{"stats":[...]}}
        statsData = response.data || {stats: []};

        // ğŸ¯ æ–°å¢: åˆå§‹åŒ–æ—¶åº”ç”¨é»˜è®¤æ’åº(æ¸ é“åç§°â†’æ¨¡å‹åç§°)
        applyDefaultSorting();

        updateSummaryCards();
        renderStatsTable();
        updateStatsCount();

      } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        if (window.showError) try { window.showError('æ— æ³•åŠ è½½ç»Ÿè®¡æ•°æ®'); } catch(_){}
        showError();
      }
    }

    function showLoading() {
      const tbody = document.getElementById('stats_tbody');
      tbody.innerHTML = `
        <tr>
          <td colspan="${STATS_TABLE_COLUMNS}" class="loading-state">
            <div class="loading-spinner" style="margin: 0 auto var(--space-2)"></div>
            æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...
          </td>
        </tr>
      `;
      
      // é‡ç½®æ‘˜è¦å¡ç‰‡
      ['total-channels', 'total-models', 'total-success', 'total-error'].forEach(id => {
        document.getElementById(id).textContent = '--';
      });
    }

    function showError() {
      const tbody = document.getElementById('stats_tbody');
      tbody.innerHTML = `
        <tr>
          <td colspan="${STATS_TABLE_COLUMNS}" class="empty-state">
            <svg class="w-12 h-12 mx-auto mb-4" style="color: var(--error-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L4.18 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
            <div style="color: var(--error-400); font-weight: var(--font-medium); margin-bottom: var(--space-1);">åŠ è½½å¤±è´¥</div>
            <div>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é‡è¯•</div>
          </td>
        </tr>
      `;
    }

    function updateSummaryCards() {
      if (!statsData || !statsData.stats) return;

      const configs = new Set();
      const models = new Set();
      let totalSuccess = 0;
      let totalError = 0;

      statsData.stats.forEach(entry => {
        configs.add(entry.channel_name);
        models.add(entry.model || 'æœªçŸ¥æ¨¡å‹');
        totalSuccess += entry.success || 0;
        totalError += entry.error || 0;
      });

      // æ›´æ–°æ‘˜è¦å¡ç‰‡
      document.getElementById('total-channels').textContent = configs.size;
      document.getElementById('total-models').textContent = models.size;
      document.getElementById('total-success').textContent = formatNumber(totalSuccess);
      document.getElementById('total-error').textContent = formatNumber(totalError);
    }

    // è¡¨æ ¼æ’åºåŠŸèƒ½
    function sortTable(column) {
      if (!statsData || !statsData.stats || statsData.stats.length === 0) return;
      
      // ç¡®å®šæ’åºçŠ¶æ€ï¼šnull -> desc -> asc -> null (ä¸‰æ€å¾ªç¯)
      let newOrder;
      if (sortState.column !== column) {
        // åˆ‡æ¢åˆ°æ–°åˆ—ï¼Œä»descå¼€å§‹
        newOrder = 'desc';
      } else {
        // åŒä¸€åˆ—å¾ªç¯ï¼šnull -> desc -> asc -> null
        if (sortState.order === null) {
          newOrder = 'desc';
        } else if (sortState.order === 'desc') {
          newOrder = 'asc';
        } else {
          newOrder = null;
        }
      }
      
      // æ›´æ–°æ’åºçŠ¶æ€
      sortState.column = newOrder ? column : null;
      sortState.order = newOrder;
      
      // æ›´æ–°è¡¨å¤´æ ·å¼
      updateSortHeaders();
      
      // æ‰§è¡Œæ’åºå¹¶é‡æ–°æ¸²æŸ“
      applySorting();
      renderStatsTable();
    }

    function updateSortHeaders() {
      // æ¸…é™¤æ‰€æœ‰åˆ—çš„æ’åºæ ·å¼
      document.querySelectorAll('.sortable').forEach(th => {
        th.classList.remove('sorted');
        th.removeAttribute('data-sort-order');
      });
      
      // å¦‚æœæœ‰æ’åºçŠ¶æ€ï¼Œè®¾ç½®å½“å‰åˆ—çš„æ ·å¼
      if (sortState.column && sortState.order) {
        const currentHeader = document.querySelector(`[data-column="${sortState.column}"]`);
        if (currentHeader) {
          currentHeader.classList.add('sorted');
          currentHeader.setAttribute('data-sort-order', sortState.order);
        }
      }
    }

    function applySorting() {
      // å¦‚æœæ²¡æœ‰æ’åºçŠ¶æ€,ä»åŸå§‹æ•°æ®æ¢å¤é»˜è®¤æ’åº(æ¸ é“åç§°â†’æ¨¡å‹åç§°)
      if (!sortState.column || !sortState.order) {
        if (statsData && statsData.originalStats) {
          statsData.stats = [...statsData.originalStats];
        }
        return;
      }

      // ä¿å­˜åŸå§‹æ•°æ®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ä¿å­˜ï¼‰
      if (!statsData.originalStats) {
        statsData.originalStats = [...statsData.stats];
      }

      const column = sortState.column;
      const isAsc = sortState.order === 'asc';

      statsData.stats.sort((a, b) => {
        let valueA, valueB;

        switch (column) {
          case 'channel_name':
            valueA = (a.channel_name || '').toLowerCase();
            valueB = (b.channel_name || '').toLowerCase();
            break;
          case 'model':
            valueA = (a.model || '').toLowerCase();
            valueB = (b.model || '').toLowerCase();
            break;
          case 'success':
            valueA = a.success || 0;
            valueB = b.success || 0;
            break;
          case 'error':
            valueA = a.error || 0;
            valueB = b.error || 0;
            break;
          case 'total':
            valueA = a.total || 0;
            valueB = b.total || 0;
            break;
          case 'success_rate':
            valueA = a.total > 0 ? (a.success / a.total) : 0;
            valueB = b.total > 0 ? (b.success / b.total) : 0;
            break;
          case 'avg_first_byte_time':
            valueA = a.avg_first_byte_time_seconds || 0;
            valueB = b.avg_first_byte_time_seconds || 0;
            break;
          case 'total_input_tokens':
            valueA = a.total_input_tokens || 0;
            valueB = b.total_input_tokens || 0;
            break;
          case 'total_output_tokens':
            valueA = a.total_output_tokens || 0;
            valueB = b.total_output_tokens || 0;
            break;
          case 'total_cache_read':
            valueA = a.total_cache_read_input_tokens || 0;
            valueB = b.total_cache_read_input_tokens || 0;
            break;
          case 'total_cache_creation':
            valueA = a.total_cache_creation_input_tokens || 0;
            valueB = b.total_cache_creation_input_tokens || 0;
            break;
          case 'total_cost':
            valueA = a.total_cost || 0;
            valueB = b.total_cost || 0;
            break;
          default:
            return 0;
        }

        let result;
        if (typeof valueA === 'string') {
          result = valueA.localeCompare(valueB, 'zh-CN');
        } else {
          result = valueA - valueB;
        }

        return isAsc ? result : -result;
      });
    }

    function renderStatsTable() {
      const tbody = document.getElementById('stats_tbody');
      
      if (!statsData || !statsData.stats || statsData.stats.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="${STATS_TABLE_COLUMNS}" class="empty-state">
              <svg class="w-12 h-12 mx-auto mb-4" style="color: var(--neutral-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <div style="font-weight: var(--font-medium); margin-bottom: var(--space-1); color: var(--neutral-700);">æš‚æ— ç»Ÿè®¡æ•°æ®</div>
              <div>è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æ£€æŸ¥æ—¶é—´èŒƒå›´</div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = '';
      for (const entry of statsData.stats) {
        const tr = document.createElement('tr');
        
        const successRate = entry.total > 0 ? ((entry.success / entry.total) * 100) : 0;
        const successRateText = successRate.toFixed(1) + '%';
        
        // æ ¹æ®æˆåŠŸç‡è®¾ç½®é¢œè‰²ç±»
        let successRateClass = 'success-rate';
        if (successRate >= 95) successRateClass += ' high';
        else if (successRate < 80) successRateClass += ' low';
        
        const modelDisplay = entry.model ?
          `<span class="model-tag">${escapeHtml(entry.model)}</span>` :
          '<span style="color: var(--neutral-500);">æœªçŸ¥æ¨¡å‹</span>';

        // æ ¼å¼åŒ–å¹³å‡é¦–å­—å“åº”æ—¶é—´ï¼ˆä¿ç•™2ä½å°æ•°ï¼Œæ˜¾ç¤º"ç§’"ï¼‰
        const avgFirstByteTime = entry.avg_first_byte_time_seconds || 0;
        const avgFirstByteTimeText = avgFirstByteTime > 0 ?
          `${avgFirstByteTime.toFixed(2)}ç§’` :
          '<span style="color: var(--neutral-400);">--</span>';

        // æ ¼å¼åŒ–Tokenæ•°æ®
        const inputTokensText = entry.total_input_tokens ? formatNumber(entry.total_input_tokens) : '<span style="color: var(--neutral-400);">--</span>';
        const outputTokensText = entry.total_output_tokens ? formatNumber(entry.total_output_tokens) : '<span style="color: var(--neutral-400);">--</span>';
        const cacheReadTokensText = entry.total_cache_read_input_tokens ?
          `<span style="color: var(--success-600);">${formatNumber(entry.total_cache_read_input_tokens)}</span>` :
          '<span style="color: var(--neutral-400);">--</span>';
        const cacheCreationTokensText = entry.total_cache_creation_input_tokens ?
          `<span style="color: var(--primary-600);">${formatNumber(entry.total_cache_creation_input_tokens)}</span>` :
          '<span style="color: var(--neutral-400);">--</span>';
        const costText = entry.total_cost ?
          `<span style="color: var(--warning-600); font-weight: 500;">${formatCost(entry.total_cost)}</span>` :
          '<span style="color: var(--neutral-400);">--</span>';

        tr.innerHTML = `
          <td>
            <a href="/web/channels.html?id=${entry.channel_id}" class="config-name channel-link" title="è·³è½¬åˆ°æ¸ é“ç®¡ç†">
              ${escapeHtml(entry.channel_name)}
            </a>
            ${entry.channel_id ? `<span class="channel-id">(ID: ${entry.channel_id})</span>` : ''}
          </td>
          <td>${modelDisplay}</td>
          <td><span class="success-count">${formatNumber(entry.success || 0)}</span></td>
          <td><span class="error-count">${formatNumber(entry.error || 0)}</span></td>
          <td><strong>${formatNumber(entry.total || 0)}</strong></td>
          <td>
            <div class="${successRateClass}">${successRateText}</div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${successRate}%"></div>
            </div>
          </td>
          <td style="text-align: center;">
            ${avgFirstByteTimeText}
          </td>
          <td style="text-align: right;">${inputTokensText}</td>
          <td style="text-align: right;">${outputTokensText}</td>
          <td style="text-align: right;">${cacheReadTokensText}</td>
          <td style="text-align: right;">${cacheCreationTokensText}</td>
          <td style="text-align: right;">${costText}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    function applyFilter() {
      const hours = document.getElementById('f_hours').value.trim();
      const id = document.getElementById('f_id').value.trim();
      const name = document.getElementById('f_name').value.trim();
      const model = document.getElementById('f_model').value.trim();

      const q = new URLSearchParams(location.search);
      if (hours) q.set('hours', hours); else q.delete('hours');
      if (id) q.set('channel_id', id); else q.delete('channel_id');
      if (name) { q.set('channel_name_like', name); q.delete('channel_name'); }
      else { q.delete('channel_name_like'); }
      if (model) { q.set('model_like', model); q.delete('model'); }
      else { q.delete('model_like'); q.delete('model'); }
      location.search = '?' + q.toString();
    }

    function initFilters() {
      const u = new URLSearchParams(location.search);
      const id = u.get('channel_id') || '';
      const name = u.get('channel_name_like') || u.get('channel_name') || '';
      const hours = u.get('hours') || '24';
      const model = u.get('model_like') || u.get('model') || '';

      document.getElementById('f_hours').value = hours;
      document.getElementById('f_id').value = id;
      document.getElementById('f_name').value = name;
      document.getElementById('f_model').value = model;

      // äº‹ä»¶ç›‘å¬
      document.getElementById('btn_filter').addEventListener('click', applyFilter);

      // å›è½¦é”®ç­›é€‰
      ['f_hours', 'f_id', 'f_name', 'f_model'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('keydown', e => {
            if (e.key === 'Enter') applyFilter();
          });
        }
      });
    }

    function updateStatsCount() {
      // æ›´æ–°ç­›é€‰å™¨ç»Ÿè®¡ä¿¡æ¯
      const statsCountEl = document.getElementById('statsCount');
      if (statsCountEl && statsData && statsData.stats) {
        statsCountEl.textContent = statsData.stats.length;
      }
    }

    // åº”ç”¨é»˜è®¤æ’åº:æŒ‰æ¸ é“åç§°å‡åº,ç›¸åŒæ¸ é“æŒ‰æ¨¡å‹åç§°å‡åº
    function applyDefaultSorting() {
      if (!statsData || !statsData.stats || statsData.stats.length === 0) return;

      // ä¿å­˜åŸå§‹æ•°æ®å‰¯æœ¬(ä»…é¦–æ¬¡)
      if (!statsData.originalStats) {
        statsData.originalStats = [...statsData.stats];
      }

      // æŒ‰æ¸ é“åç§°å‡åº,ç›¸åŒæ¸ é“æŒ‰æ¨¡å‹åç§°å‡åº
      statsData.stats.sort((a, b) => {
        const channelA = (a.channel_name || '').toLowerCase();
        const channelB = (b.channel_name || '').toLowerCase();

        // é¦–å…ˆæŒ‰æ¸ é“åç§°æ’åº
        const channelCompare = channelA.localeCompare(channelB, 'zh-CN');
        if (channelCompare !== 0) return channelCompare;

        // æ¸ é“åç§°ç›¸åŒæ—¶,æŒ‰æ¨¡å‹åç§°æ’åº
        const modelA = (a.model || '').toLowerCase();
        const modelB = (b.model || '').toLowerCase();
        return modelA.localeCompare(modelB, 'zh-CN');
      });

      // é‡ç½®æ’åºçŠ¶æ€(ä¿æŒæ— æ’åºæŒ‡ç¤ºå™¨æ˜¾ç¤º)
      sortState.column = null;
      sortState.order = null;
    }

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    // æ ¼å¼åŒ–æˆæœ¬ï¼ˆç¾å…ƒï¼‰- å¤ç”¨logs.htmlçš„é€»è¾‘
    function formatCost(cost) {
      if (cost === 0) return '$0.00';
      if (cost < 0.001) {
        // å°é¢æˆæœ¬ï¼šä½¿ç”¨æ›´å¤šå°æ•°ä½
        if (cost < 0.000001) {
          return '$' + cost.toExponential(2); // ç§‘å­¦è®¡æ•°æ³•
        }
        return '$' + cost.toFixed(6).replace(/\.?0+$/, ''); // æœ€å¤š6ä½å°æ•°ï¼Œå»é™¤å°¾éš0
      }
      if (cost >= 1.0) {
        return '$' + cost.toFixed(2); // å¤§äº$1æ˜¾ç¤º2ä½å°æ•°
      }
      return '$' + cost.toFixed(4).replace(/\.?0+$/, ''); // å¦åˆ™æ˜¾ç¤º4ä½å°æ•°ï¼Œå»é™¤å°¾éš0
    }

    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/[&<>"']/g, c => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[c]));
    }


    // æ³¨é”€åŠŸèƒ½ï¼ˆå·²ç”± ui.js çš„ onLogout ç»Ÿä¸€å¤„ç†ï¼‰

    // é¡¶æ å¸ƒå±€ä¸‹ï¼Œæ— éœ€ä¾§æ å“åº”é€»è¾‘
    function handleResize() {}

    // é¡µé¢åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      if (window.initTopbar) initTopbar('stats');
      initFilters();
      loadStats();
      
      // å“åº”å¼å¤„ç†
      handleResize();
      window.addEventListener('resize', handleResize);
    });
  </script>
  <script src="/web/ui.js"></script>
</body>
</html>
